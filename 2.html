<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kahoot-like — Student</title>
<style>
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#0b1020;color:#fff;margin:0}
  .wrap{max-width:720px;margin:18px auto;padding:12px}
  .card{background:#1e293b;padding:18px;border-radius:14px}
  input,button{padding:12px;border-radius:10px;border:none;font-size:15px}
  button{background:#2563eb;color:#fff;cursor:pointer}
  .timer{font-weight:800;font-size:20px;margin-bottom:10px;color:#fef08a}
  .question{font-size:20px;font-weight:800;margin-bottom:14px}
  .opts{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .opt{padding:20px;border-radius:14px;font-weight:800;text-align:center;cursor:pointer}
  .red{background:#e63946}.blue{background:#2a9df4}.yellow{background:#f4b400;color:#111}.green{background:#2ec4b6}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="joinCard">
    <input id="nameInput" placeholder="Tên của bạn" style="width:100%;margin-bottom:8px"/>
    <input id="roomInput" placeholder="Mã phòng" style="width:100%;margin-bottom:8px"/>
    <button id="joinBtn">Join</button>
  </div>

  <div class="card" id="playCard" style="display:none;margin-top:14px">
    <div class="timer">⏳ <span id="timeLeft">0</span>s</div>
    <div class="question" id="qText">Chờ...</div>
    <div id="opts" class="opts"></div>
    <div style="margin-top:10px">Điểm: <span id="myScore">0</span> | Hạng: <span id="myRank">-</span></div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyBMIxJxZ4GC8HTTKREB45SRSbTay15Kg7I",
authDomain:"kahoot-like-5251e.firebaseapp.com",
databaseURL:"https://kahoot-like-5251e-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"kahoot-like-5251e",storageBucket:"kahoot-like-5251e.appspot.com",
messagingSenderId:"805207333072",appId:"1:805207333072:web:63d23d41b05fa6bd71e6d5"};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let roomId=null,playerId="p"+Math.floor(Math.random()*1e6),playerName="";
document.getElementById("joinBtn").onclick=async()=>{
  playerName=document.getElementById("nameInput").value;
  roomId=document.getElementById("roomInput").value;
  await db.ref("rooms/"+roomId+"/players/"+playerId).set({name:playerName});
  document.getElementById("joinCard").style.display="none";
  document.getElementById("playCard").style.display="block";
  listenQ();listenRank();
};

function listenQ(){
  db.ref("rooms/"+roomId+"/current").on("value",snap=>{
    const cur=snap.val();if(!cur)return;
    document.getElementById("timeLeft").textContent=cur.timeLeft||0;
    if(cur.status==="open"){showQ(cur.q);}else{document.getElementById("opts").innerHTML="";}
  });
}
function showQ(q){
  document.getElementById("qText").textContent=q.text;
  const box=document.getElementById("opts");box.innerHTML="";
  const colors=["red","blue","yellow","green"];
  const opts=(q.options||[]).map((txt,i)=>({txt,i}));
  for(let i=opts.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[opts[i],opts[j]]=[opts[j],opts[i]];}
  opts.forEach((o,k)=>{const d=document.createElement("div");d.className="opt "+colors[k%4];d.textContent=String.fromCharCode(65+k)+". "+o.txt;d.onclick=()=>submitAnswer(o.i);box.appendChild(d);});
}
async function submitAnswer(ans){await db.ref("rooms/"+roomId+"/current/answers/"+playerId).set({name:playerName,answer:ans,time:Date.now()});document.getElementById("opts").innerHTML="<i>Đã trả lời</i>";}
function listenRank(){
  db.ref("rooms/"+roomId+"/scores/"+playerId).on("value",s=>{document.getElementById("myScore").textContent=s.val()||0;});
  db.ref("rooms/"+roomId+"/ranking").on("value",snap=>{const arr=snap.val()||[];let rank="-";arr.forEach((r,i)=>{if(r.pid===playerId)rank=i+1;});document.getElementById("myRank").textContent=rank;});
}
</script>
</body>
</html>
